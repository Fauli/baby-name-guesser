import{d as g,r,w as h,n as w,c as l,a as e,t as u,F as c,e as _,o,f as C}from"./index-7a118acb.js";const V={key:0},$=e("p",null,"You probably don't have access to this resource :)",-1),j=[$],N={key:1},P={key:2},A=e("h1",null,"Admin Panel",-1),B=e("hr",null,null,-1),E=e("h2",null,"Users",-1),M={class:"table-container"},x={key:0},L={key:1},O=["onClick"],S={key:0},U={key:1},F=e("br",null,null,-1),D=e("br",null,null,-1),I=e("h2",null,"Votes by User",-1),K={class:"table-container"},R=e("thead",null,[e("tr",null,[e("th",null,"Voter"),e("th",null,"Names")])],-1),T={key:0},Y=e("br",null,null,-1),q=e("br",null,null,-1),z=e("h2",null,"Votes",-1),G={class:"table-container"},H=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Votes")])],-1),m="/api",W=g({__name:"AdminView",setup(J){const a=r(""),v=r(""),p=r([]),f=r(""),d=r(1);h(async()=>{const s=`${m}/voters`;a.value=await(await fetch(s)).json()}),h(async()=>{const s=`${m}/votes/voters`;p.value=await(await fetch(s)).json()}),h(async()=>{const s=`${m}/votes`;v.value=await(await fetch(s)).json()});function k(s){console.log("Marking user as paid:",s),fetch("/api/payments/"+s,{method:"POST"}).then(n=>n.json()).then(n=>{console.log("Success:",n),n.message.includes("has been processed")?(console.log("Marking as paid successful"),a.value=a.value.map(t=>(t.email===s&&(t.has_paid=!0),t))):(console.log("Marking as paid failed"),alert("Marking as paid failed: "+n.message))}).catch(n=>{console.error("Error:",n)})}function i(s){f.value===s?d.value*=-1:(f.value=s,d.value=1),a.value=[...a.value].sort((n,t)=>n[s]>t[s]?d.value:n[s]<t[s]?-d.value:0)}const b=w(()=>Object.entries(v.value).sort(([,s],[,n])=>n-s).map(([s,n])=>({name:s,voteCount:n})));return(s,n)=>a.value?a.value.message?(o(),l("div",N,[e("p",null,u(a.value.message),1)])):(o(),l("div",P,[A,B,E,e("div",M,[e("table",null,[e("thead",null,[e("tr",null,[e("th",{onClick:n[0]||(n[0]=t=>i("has_voted"))},"Voted"),e("th",{onClick:n[1]||(n[1]=t=>i("has_paid"))},"Paid"),e("th",{onClick:n[2]||(n[2]=t=>i("name"))},"Name"),e("th",{onClick:n[3]||(n[3]=t=>i("last_name"))},"Last Name"),e("th",{onClick:n[4]||(n[4]=t=>i("email"))},"Email")])]),e("tbody",null,[(o(!0),l(c,null,_(a.value,t=>(o(),l("tr",{key:t.id},[e("td",null,[t.has_voted?(o(),l("span",x,"✅")):(o(),l("span",L,"❌"))]),e("td",null,[e("a",{onClick:y=>k(t.email)},[t.has_paid?(o(),l("span",S,"💰")):(o(),l("span",U,"❌"))],8,O)]),e("td",null,u(t.name),1),e("td",null,u(t.last_name),1),e("td",null,u(t.email),1)]))),128))])])]),F,D,I,e("div",K,[e("table",null,[R,e("tbody",null,[(o(!0),l(c,null,_(p.value,t=>(o(),l("tr",null,[e("td",null,u(t.email),1),t.names?(o(),l("td",T,[(o(!0),l(c,null,_(t.names,y=>(o(),l("span",null,u(y)+", ",1))),256))])):C("",!0)]))),256))])])]),Y,q,z,e("div",G,[e("table",null,[H,e("tbody",null,[(o(!0),l(c,null,_(b.value,t=>(o(),l("tr",{key:t.name},[e("td",null,u(t.name),1),e("td",null,u(t.voteCount),1)]))),128))])])])])):(o(),l("div",V,j))}});export{W as default};
