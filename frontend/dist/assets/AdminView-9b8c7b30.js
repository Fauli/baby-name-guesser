import{d as C,r,w as h,n as y,c as s,a as e,t as u,F as c,e as m,o,f as w}from"./index-c05bcbdd.js";const V={key:0},$=e("p",null,"You probably don't have access to this resource :)",-1),j=[$],M={key:1},N={key:2},P=e("h1",null,"Admin Panel",-1),A=e("hr",null,null,-1),B=e("h2",null,"Users",-1),E={class:"table-container"},O={key:0},x={key:1},F=["onClick"],L={key:0},S={key:1},U=e("br",null,null,-1),D=e("br",null,null,-1),H=e("h2",null,"Votes by User",-1),I={class:"table-container"},K=e("thead",null,[e("tr",null,[e("th",null,"Voter"),e("th",null,"Names")])],-1),R={key:0},T=e("br",null,null,-1),Y=e("br",null,null,-1),q=e("h2",null,"Votes",-1),z={class:"table-container"},G=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Votes")])],-1),J=e("br",null,null,-1),Q=e("br",null,null,-1),W=e("h2",null,"Collected money",-1),v="/api",te=C({__name:"AdminView",setup(X){const a=r(""),_=r(""),p=r([]),f=r(""),d=r(1);h(async()=>{const l=`${v}/voters`;a.value=await(await fetch(l)).json()}),h(async()=>{const l=`${v}/votes/voters`;p.value=await(await fetch(l)).json()}),h(async()=>{const l=`${v}/votes`;_.value=await(await fetch(l)).json()});function b(l){console.log("Marking user as paid:",l),fetch("/api/payments/"+l,{method:"POST"}).then(t=>t.json()).then(t=>{console.log("Success:",t),t.message.includes("has been processed")?(console.log("Marking as paid successful"),a.value=a.value.map(n=>(n.email===l&&(n.has_paid=!0),n))):(console.log("Marking as paid failed"),alert("Marking as paid failed: "+t.message))}).catch(t=>{console.error("Error:",t)})}function i(l){f.value===l?d.value*=-1:(f.value=l,d.value=1),a.value=[...a.value].sort((t,n)=>t[l]>n[l]?d.value:t[l]<n[l]?-d.value:0)}const k=y(()=>Object.entries(_.value).sort(([,l],[,t])=>t-l).map(([l,t])=>({name:l,voteCount:t}))),g=y(()=>Object.values(_.value).reduce((l,t)=>l+t*10,0));return(l,t)=>(o(),s(c,null,[a.value?a.value.message?(o(),s("div",M,[e("p",null,u(a.value.message),1)])):(o(),s("div",N,[P,A,B,e("div",E,[e("table",null,[e("thead",null,[e("tr",null,[e("th",{onClick:t[0]||(t[0]=n=>i("has_voted"))},"Voted"),e("th",{onClick:t[1]||(t[1]=n=>i("has_paid"))},"Paid"),e("th",{onClick:t[2]||(t[2]=n=>i("name"))},"Name"),e("th",{onClick:t[3]||(t[3]=n=>i("last_name"))},"Last Name"),e("th",{onClick:t[4]||(t[4]=n=>i("email"))},"Email")])]),e("tbody",null,[(o(!0),s(c,null,m(a.value,n=>(o(),s("tr",{key:n.id},[e("td",null,[n.has_voted?(o(),s("span",O,"✅")):(o(),s("span",x,"❌"))]),e("td",null,[e("a",{onClick:Z=>b(n.email)},[n.has_paid?(o(),s("span",L,"💰")):(o(),s("span",S,"❌"))],8,F)]),e("td",null,u(n.name),1),e("td",null,u(n.last_name),1),e("td",null,u(n.email),1)]))),128))])])]),U,D,H,e("div",I,[e("table",null,[K,e("tbody",null,[(o(!0),s(c,null,m(p.value,n=>(o(),s("tr",null,[e("td",null,u(n.email),1),n.names?(o(),s("td",R,[e("span",null,u(n.names.join(", ")),1)])):w("",!0)]))),256))])])]),T,Y,q,e("div",z,[e("table",null,[G,e("tbody",null,[(o(!0),s(c,null,m(k.value,n=>(o(),s("tr",{key:n.name},[e("td",null,u(n.name),1),e("td",null,u(n.voteCount),1)]))),128))])])])])):(o(),s("div",V,j)),J,Q,W,e("p",null,u(g.value)+" CHF",1)],64))}});export{te as default};
