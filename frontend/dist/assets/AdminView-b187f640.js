import{d as w,r,w as m,n as b,c as s,a as e,t as u,F as d,e as _,o,f as V}from"./index-15eff7d7.js";const $={key:0},j=e("p",null,"You probably don't have access to this resource :)",-1),M=[j],N={key:1},P={key:2},A=e("h1",null,"Admin Panel",-1),B=e("hr",null,null,-1),E=e("h2",null,"Users",-1),O={class:"table-container"},x={key:0},F={key:1},L=["onClick"],S={key:0},U={key:1},D=e("br",null,null,-1),H=e("br",null,null,-1),I=e("h2",null,"Votes by User",-1),K={class:"table-container"},R=e("thead",null,[e("tr",null,[e("th",null,"Voter"),e("th",null,"Names")])],-1),T={key:0},Y=e("br",null,null,-1),q=e("br",null,null,-1),z=e("h2",null,"Votes",-1),G={class:"table-container"},J=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Votes")])],-1),Q=e("br",null,null,-1),W=e("br",null,null,-1),X=e("h2",null,"Collected money",-1),v="/api",te=w({__name:"AdminView",setup(Z){const a=r(""),h=r(""),p=r([]),f=r(""),c=r(1);m(async()=>{const l=`${v}/voters`;a.value=await(await fetch(l)).json()}),m(async()=>{const l=`${v}/votes/voters`;p.value=await(await fetch(l)).json()}),m(async()=>{const l=`${v}/votes`;h.value=await(await fetch(l)).json()});function k(l){console.log("Marking user as paid:",l),fetch("/api/payments/"+l,{method:"POST"}).then(t=>t.json()).then(t=>{console.log("Success:",t),t.message.includes("has been processed")?(console.log("Marking as paid successful"),a.value=a.value.map(n=>(n.email===l&&(n.has_paid=!0),n))):(console.log("Marking as paid failed"),alert("Marking as paid failed: "+t.message))}).catch(t=>{console.error("Error:",t)})}function i(l){f.value===l?c.value*=-1:(f.value=l,c.value=1),a.value=[...a.value].sort((t,n)=>t[l]>n[l]?c.value:t[l]<n[l]?-c.value:0)}const g=b(()=>Object.entries(h.value).sort(([,l],[,t])=>t-l).map(([l,t])=>({name:l,voteCount:t}))),C=b(()=>Object.values(h.value).reduce((l,t)=>l+t*10,0));return(l,t)=>(o(),s(d,null,[a.value?a.value.message?(o(),s("div",N,[e("p",null,u(a.value.message),1)])):(o(),s("div",P,[A,B,E,e("div",O,[e("table",null,[e("thead",null,[e("tr",null,[e("th",{onClick:t[0]||(t[0]=n=>i("has_voted"))},"Voted"),e("th",{onClick:t[1]||(t[1]=n=>i("has_paid"))},"Paid"),e("th",{onClick:t[2]||(t[2]=n=>i("name"))},"Name"),e("th",{onClick:t[3]||(t[3]=n=>i("last_name"))},"Last Name"),e("th",{onClick:t[4]||(t[4]=n=>i("email"))},"Email")])]),e("tbody",null,[(o(!0),s(d,null,_(a.value,n=>(o(),s("tr",{key:n.id},[e("td",null,[n.has_voted?(o(),s("span",x,"âœ…")):(o(),s("span",F,"âŒ"))]),e("td",null,[e("a",{onClick:y=>k(n.email)},[n.has_paid?(o(),s("span",S,"ðŸ’°")):(o(),s("span",U,"âŒ"))],8,L)]),e("td",null,u(n.name),1),e("td",null,u(n.last_name),1),e("td",null,u(n.email),1)]))),128))])])]),D,H,I,e("div",K,[e("table",null,[R,e("tbody",null,[(o(!0),s(d,null,_(p.value,n=>(o(),s("tr",null,[e("td",null,u(n.email),1),n.names?(o(),s("td",T,[(o(!0),s(d,null,_(n.names,y=>(o(),s("span",null,u(y)+", ",1))),256))])):V("",!0)]))),256))])])]),Y,q,z,e("div",G,[e("table",null,[J,e("tbody",null,[(o(!0),s(d,null,_(g.value,n=>(o(),s("tr",{key:n.name},[e("td",null,u(n.name),1),e("td",null,u(n.voteCount),1)]))),128))])])])])):(o(),s("div",$,M)),Q,W,X,e("p",null,u(C.value)+" CHF",1)],64))}});export{te as default};
